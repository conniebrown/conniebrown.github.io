var pipwerks={};pipwerks.UTILS={};pipwerks.debug={isActive:false};pipwerks.SCORM={version:null,handleCompletionStatus:true,handleExitMode:true,API:{handle:null,isFound:false},connection:{isActive:false},data:{completionStatus:null,exitStatus:null},debug:{}};pipwerks.SCORM.isAvailable=function(){return true};pipwerks.SCORM.API.find=function(f){var b=null,c=0,d=500,g="SCORM.API.find",e=pipwerks.UTILS.trace,a=pipwerks.SCORM;while((!f.API&&!f.API_1484_11)&&(f.parent)&&(f.parent!=f)&&(c<=d)){c++;f=f.parent}if(a.version){switch(a.version){case"2004":if(f.API_1484_11){b=f.API_1484_11}else{e(g+": SCORM version 2004 was specified by user, but API_1484_11 cannot be found.")}break;case"1.2":if(f.API){b=f.API}else{e(g+": SCORM version 1.2 was specified by user, but API cannot be found.")}break}}else{if(f.API_1484_11){a.version="2004";b=f.API_1484_11}else{if(f.API){a.version="1.2";b=f.API}}}if(b){e(g+": API found. Version: "+a.version);e("API: "+b)}else{e(g+": Error finding API. \nFind attempts: "+c+". \nFind attempt limit: "+d)}return b};pipwerks.SCORM.API.get=function(){var b=null,d=window,a=pipwerks.SCORM,e=a.API.find,c=pipwerks.UTILS.trace;if(d.parent&&d.parent!=d){b=e(d.parent)}if(!b&&d.top.opener){b=e(d.top.opener)}if(!b&&d.top.opener&&d.top.opener.document){b=e(d.top.opener.document)}if(b){a.API.isFound=true}else{c("API.get failed: Can't find the API!")}return b};pipwerks.SCORM.API.getHandle=function(){var a=pipwerks.SCORM.API;if(!a.handle&&!a.isFound){a.handle=a.get()}return a.handle};pipwerks.SCORM.connection.initialize=function(){var f=false,h=pipwerks.SCORM,c=h.data.completionStatus,d=pipwerks.UTILS.trace,i=pipwerks.UTILS.StringToBoolean,a=h.debug,g="SCORM.connection.initialize ";d("connection.initialize called.");if(!h.connection.isActive){var b=h.API.getHandle(),e=0;if(b){switch(h.version){case"1.2":f=i(b.LMSInitialize(""));break;case"2004":f=i(b.Initialize(""));break}if(f){e=a.getCode();if(e!==null&&e===0){h.connection.isActive=true;if(h.handleCompletionStatus){c=h.status("get");if(c){switch(c){case"not attempted":h.status("set","incomplete");break;case"unknown":h.status("set","incomplete");break}}}}else{f=false;d(g+"failed. \nError code: "+e+" \nError info: "+a.getInfo(e))}}else{e=a.getCode();if(e!==null&&e!==0){d(g+"failed. \nError code: "+e+" \nError info: "+a.getInfo(e))}else{d(g+"failed: No response from server.")}}}else{d(g+"failed: API is null.")}}else{d(g+"aborted: Connection already active.")}return f};pipwerks.SCORM.connection.terminate=function(){var g=false,i=pipwerks.SCORM,c=i.data.exitStatus,d=i.data.completionStatus,e=pipwerks.UTILS.trace,j=pipwerks.UTILS.StringToBoolean,a=i.debug,h="SCORM.connection.terminate ";if(i.connection.isActive){var b=i.API.getHandle(),f=0;if(b){if(i.handleExitMode&&!c){if(d!=="completed"&&d!=="passed"){switch(i.version){case"1.2":g=i.set("cmi.core.exit","suspend");break;case"2004":g=i.set("cmi.exit","suspend");break}}else{switch(i.version){case"1.2":g=i.set("cmi.core.exit","logout");break;case"2004":g=i.set("cmi.exit","normal");break}}}switch(i.version){case"1.2":g=j(b.LMSFinish(""));break;case"2004":g=j(b.Terminate(""));break}if(g){i.connection.isActive=false}else{f=a.getCode();e(h+"failed. \nError code: "+f+" \nError info: "+a.getInfo(f))}}else{e(h+"failed: API is null.")}}else{e(h+"aborted: Connection already terminated.")}return g};pipwerks.SCORM.data.get=function(h){var e=null,a=pipwerks.SCORM,d=pipwerks.UTILS.trace,c=a.debug,g="SCORM.data.get("+h+") ";if(a.connection.isActive){var b=a.API.getHandle(),f=0;if(b){switch(a.version){case"1.2":e=b.LMSGetValue(h);break;case"2004":e=b.GetValue(h);break}f=c.getCode();if(e!==""||f===0){switch(h){case"cmi.core.lesson_status":case"cmi.completion_status":a.data.completionStatus=e;break;case"cmi.core.exit":case"cmi.exit":a.data.exitStatus=e;break}}else{d(g+"failed. \nError code: "+f+"\nError info: "+c.getInfo(f))}}else{d(g+"failed: API is null.")}}else{d(g+"failed: API connection is inactive.")}d(g+" value: "+e);return String(e)};pipwerks.SCORM.data.set=function(e,f){var g=false,i=pipwerks.SCORM,c=pipwerks.UTILS.trace,j=pipwerks.UTILS.StringToBoolean,a=i.debug,h="SCORM.data.set("+e+") ";if(i.connection.isActive){var b=i.API.getHandle(),d=0;if(b){switch(i.version){case"1.2":g=j(b.LMSSetValue(e,f));break;case"2004":g=j(b.SetValue(e,f));break}if(g){if(e==="cmi.core.lesson_status"||e==="cmi.completion_status"){i.data.completionStatus=f}}else{c(h+"failed. \nError code: "+d+". \nError info: "+a.getInfo(d))}}else{c(h+"failed: API is null.")}}else{c(h+"failed: API connection is inactive.")}return g};pipwerks.SCORM.data.save=function(){var f=false,b=pipwerks.SCORM,d=pipwerks.UTILS.trace,a=pipwerks.UTILS.StringToBoolean,e="SCORM.data.save failed";if(b.connection.isActive){var c=b.API.getHandle();if(c){switch(b.version){case"1.2":f=a(c.LMSCommit(""));break;case"2004":f=a(c.Commit(""));break}}else{d(e+": API is null.")}}else{d(e+": API connection is inactive.")}return f};pipwerks.SCORM.status=function(e,b){var g=false,a=pipwerks.SCORM,d=pipwerks.UTILS.trace,f="SCORM.getStatus failed",c="";if(e!==null){switch(a.version){case"1.2":c="cmi.core.lesson_status";break;case"2004":c="cmi.completion_status";break}switch(e){case"get":g=a.data.get(c);break;case"set":if(b!==null){g=a.data.set(c,b)}else{g=false;d(f+": status was not specified.")}break;default:g=false;d(f+": no valid action was specified.")}}else{d(f+": action was not specified.")}return g};pipwerks.SCORM.debug.getCode=function(){var a=pipwerks.SCORM,b=a.API.getHandle(),d=pipwerks.UTILS.trace,c=0;if(b){switch(a.version){case"1.2":c=parseInt(b.LMSGetLastError(),10);break;case"2004":c=parseInt(b.GetLastError(),10);break}}else{d("SCORM.debug.getCode failed: API is null.")}return c};pipwerks.SCORM.debug.getInfo=function(e){var b=pipwerks.SCORM,c=b.API.getHandle(),d=pipwerks.UTILS.trace,a="";if(c){switch(b.version){case"1.2":a=c.LMSGetErrorString(e.toString());break;case"2004":a=c.GetErrorString(e.toString());break}}else{d("SCORM.debug.getInfo failed: API is null.")}return String(a)};pipwerks.SCORM.debug.getDiagnosticInfo=function(e){var b=pipwerks.SCORM,c=b.API.getHandle(),d=pipwerks.UTILS.trace,a="";if(c){switch(b.version){case"1.2":a=c.LMSGetDiagnostic(e);break;case"2004":a=c.GetDiagnostic(e);break}}else{d("SCORM.debug.getDiagnosticInfo failed: API is null.")}return String(a)};pipwerks.SCORM.init=pipwerks.SCORM.connection.initialize;pipwerks.SCORM.get=pipwerks.SCORM.data.get;pipwerks.SCORM.set=pipwerks.SCORM.data.set;pipwerks.SCORM.save=pipwerks.SCORM.data.save;pipwerks.SCORM.quit=pipwerks.SCORM.connection.terminate;pipwerks.UTILS.StringToBoolean=function(b){var a=typeof b;switch(a){case"object":case"string":return(/(true|1)/i).test(b);case"number":return !!b;case"boolean":return b;case"undefined":return null;default:return false}};pipwerks.UTILS.trace=function(a){if(pipwerks.debug.isActive){if(window.console&&window.console.log){console.log(a)}else{}}};
var getURLParameter=function(a){return decodeURIComponent((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null};var ApiTinCan=(function(){var u,a=false,s={initilized:{id:"http://adlnet.gov/expapi/verbs/initialized",display:{"en-GB":"initialised","en-US":"initialized",es:"inició",und:"initialised"}},terminated:{id:"http://adlnet.gov/expapi/verbs/terminated",display:{"en-GB":"terminated","en-US":"terminated",es:"cerró",und:"terminated"}},experienced:{id:"http://adlnet.gov/expapi/verbs/experienced",display:{"en-GB":"experienced","en-US":"experienced",es:"visitó",und:"experienced"}},incomplete:{id:"http://adlnet.gov/expapi/verbs/attempted",display:{"en-GB":"attempted","en-US":"attempted",es:"no completó",und:"attempted"}},completed:{id:"http://adlnet.gov/expapi/verbs/completed",display:{"en-GB":"completed","en-US":"completed",es:"completó",und:"completed"}},passed:{id:"http://adlnet.gov/expapi/verbs/passed",display:{"en-GB":"passed","en-US":"passed",es:"aprobó",und:"passed"}},failed:{id:"http://adlnet.gov/expapi/verbs/failed",display:{"en-GB":"failed","en-US":"failed",es:"suspendió",und:"failed"}},answered:{id:"http://adlnet.gov/expapi/verbs/answered",display:{"en-GB":"answered","en-US":"answered",es:"respondió",und:"answered"}}},m=["not attempted","incomplete","completed","passed","failed"],v=["N","I","C","P","F"],n,e=m[0],k=0,i="",j="",f=0,b=1,g=0,h=0,c=false,q=function(){u.getState(TrackingConfig.TinCanStateId,{callback:function(x,z){if(z){var y=typeof(z.contents)==="string"?$.parseJSON(z.contents):z.contents;if(y.status){var w=$.inArray(y.status,v);if(w===-1){e=m[0]}else{e=m[w]}}if(y.score){k=$.isNumeric(y.score)?+y.score:0}if(y.suspend){i=y.suspend}if(y.location){j=y.location}f=$.isNumeric(y.totaltime)?+y.totaltime:0;b=($.isNumeric(y.attemps)?+y.attemps:0)+1}$(window).trigger({type:"dataTrackingReady"});r()}})},r=function(){l();u.setState(TrackingConfig.TinCanStateId,{status:e.substring(0,1).toUpperCase(),score:k,suspend:i,location:j,totaltime:_totaltime,lastAccess:n.getTime(),attemps:b,timeStamp:new Date().getTime()},{contentType:"application/json"})},l=function(){var x=new Date().getTime()-n.getTime()-g,y,w=f+x;_totaltime=w;y={completion:"passed,failed,completed".indexOf(e)!==-1,score:{scaled:k/100},extensions:{"http://www.learningcoffee.com/tincan/extensions/total_time":w,"http://www.learningcoffee.com/tincan/extensions/session_time":x,"http://www.learningcoffee.com/tincan/extensions/attemp_number":b},duration:p(parseInt(w/1000,10))};if(e==="passed"||e==="failed"){$.extend(y,{success:e==="passed"})}return y},t=function(){u.sendStatements([{verb:s[e],result:l()}])},p=function(z){var y=parseInt((z)/3600,10),w=parseInt(((z)%3600)/60,10),x=parseInt(((z)%3600)%60,10),A="PT";A+=(y>0)?y+"H":"";A+=(w>0)?w+"M":"";A+=x+"S";return A},d=function(){if(c){g+=new Date().getTime()-h;c=false}},o=function(){c=true;h=new Date().getTime()};return{init:function(){try{var x=TrackingConfig.TinCanAuth?{auth:TrackingConfig.TinCanAuth}:{username:TrackingConfig.TinCanAuthUser,password:TrackingConfig.TinCanPassword};window.addEventListener("pageshow",d,false);window.addEventListener("pagehide",o,false);if(TrackingConfig.TinCanEndPoint.substring(TrackingConfig.TinCanEndPoint.length-1)!=="/"){TrackingConfig.TinCanEndPoint+="/"}n=new Date();if(getURLParameter("endpoint")){TrackingConfig.TinCanStateId="courseStateId";u=new TinCan({url:window.location.href})}else{u=new TinCan({activity:{id:"http://www.learningcoffee.com/"+$("body").attr("data-course-id"),objectType:"Activity",definition:{name:{und:window.document.title}}},recordStores:[$.extend({endpoint:TrackingConfig.TinCanEndPoint,version:"0.95"},x)]});u.actor=new TinCan.Agent({mbox:TrackingConfig.TinCanUserMail,name:TrackingConfig.TinCanUserName})}u.sendStatements([{verb:s.initilized}]);q();return true}catch(w){return false}},getStatus:function(){return e},setStatus:function(w){if($.inArray(w,m)!==-1){if(e!=w){e=w;r();t()}}},getScore:function(){return k},setScore:function(w){if($.isNumeric(w)){w=+w;if(k!==w){k=w;r();t()}}},getMasteryScore:function(){return TrackingConfig.TinCanMasteryScore},setSuspend:function(w){i=w},getSuspend:function(){return i},setLocation:function(w,x){if(w!=j){j=w;r();u.sendStatements([{object:{id:"http://www.learningcoffee.com/"+$("body").attr("data-course-id")+"/"+w,objectType:"Activity",definition:{name:{"en-US":x}}},verb:s.experienced,context:{contextActivities:{parent:"http://www.learningcoffee.com/"+$("body").attr("data-course-id")}}}])}},getLocation:function(){return j},setInteraction:function(w){r();var x={object:{id:"http://www.learningcoffee.com/"+$("body").attr("data-course-id")+"/"+w.getIdDetail(),objectType:"Activity",definition:{name:{und:w.getDescription()},type:"http://adlnet.gov/expapi/activities/cmi.interaction",interactionType:w.getTypeActivity(),correctResponsesPattern:w.getCorrectResponse(),choices:w.choices}},verb:s.answered,context:{contextActivities:{parent:"http://www.learningcoffee.com/"+$("body").attr("data-course-id")}},result:{success:w.getResult()==="correct",response:w.getStudentResponse()}};u.sendStatements([x])},getLearnerResponse:function(w){return null},getNumberInteractions:function(){return 0},exit:function(){if(!a){r();u.sendStatements([{verb:s.terminated,result:l()}]);a=true}}}});var ApiScorm_1_2=(function(){var g,d,c,h,e,b,a,f=false;var i=function(){var l,j,m="",k=new Date().getTime();k-=g;k=Math.round(k/1000);l=Math.floor(k/3600);k=k-(l*3600);j=Math.floor(k/60);k=k-(j*60);if(l<10){m+="0"}m+=l+":";if(j<10){m+="0"}m+=j+":";if(k<10){m+="0"}m+=k;return m};return{init:function(){g=new Date().getTime();pipwerks.SCORM.version="1.2";pipwerks.SCORM.handleExitMode=false;return pipwerks.SCORM.init()},getStatus:function(){d=d?d:pipwerks.SCORM.get("cmi.core.lesson_status");return d},setStatus:function(j){d=j;pipwerks.SCORM.set("cmi.core.lesson_status",d);pipwerks.SCORM.save()},getScore:function(){if(c){return c}else{c=pipwerks.SCORM.get("cmi.core.score.raw");c=$.isNumeric(c)?+c:0;return c}},setScore:function(j){if($.isNumeric(j)){c=parseInt(j,10);pipwerks.SCORM.set("cmi.core.score.raw",c);pipwerks.SCORM.set("cmi.core.score.min",0);pipwerks.SCORM.set("cmi.core.score.max",100);pipwerks.SCORM.save()}},getMasteryScore:function(){if(b){return b}b=pipwerks.SCORM.get("cmi.student_data.mastery_score");if(!$.isNumeric(b)){b=80}return b},setSuspend:function(j){h=j;pipwerks.SCORM.set("cmi.suspend_data",h)},getSuspend:function(){if(h){return h}else{h=pipwerks.SCORM.get("cmi.suspend_data");h=(h==="null"||h===null)?"":h;return h}},setLocation:function(j,k){e=j;pipwerks.SCORM.set("cmi.core.lesson_location",e);pipwerks.SCORM.save()},getLocation:function(){if(e){return e}else{e=pipwerks.SCORM.get("cmi.core.lesson_location");e=(e==="null"||e===null)?"":e;return e}},setInteraction:function(j){pipwerks.SCORM.set("cmi.interactions."+a+".id",j.getId());pipwerks.SCORM.set("cmi.interactions."+a+".type",j.getTypeActivity());pipwerks.SCORM.set("cmi.interactions."+a+".result",j.getResult());pipwerks.SCORM.set("cmi.interactions."+a+".student_response",j.getStudentResponse());pipwerks.SCORM.set("cmi.interactions."+a+".correct_responses.0.pattern",j.getCorrectResponse());pipwerks.SCORM.set("cmi.interactions."+a+".objectives.0.id",j.getIdDetail());a++},getLearnerResponse:function(j){return null},getNumberInteractions:function(){a=pipwerks.SCORM.get("cmi.interactions._count");a=$.isNumeric(a)?+a:0;return a},exit:function(){if(!f){if(TrackingConfig.send_score==="true"&&TrackingConfig.send_status==="false"){TrackingLC.getApiTracking().setScore(TrackingLC.getCourse().getScore())}else{oCourse=TrackingLC.getCourse();oApiTracking=TrackingLC.getApiTracking();if(CONFIG_CLIENT.client=="sant_mex"){if((oApiTracking.getStatus()!="passed")&&(oCourse.getStatus()=="P")&&(oApiTracking.getScore()<oCourse.getMinPassScore())){oApiTracking.setScore(Math.round(oCourse.getScore()));oApiTracking.setStatus("passed")}}}pipwerks.SCORM.set("cmi.core.session_time",i());pipwerks.SCORM.connection.terminate();f=true}}}});var ApiScorm_2004=(function(){var g,d,c,h,e,b,a,f=false;var i=function(){var l,j,m="",k=new Date().getTime();k-=g;k=Math.round(k/1000);l=Math.floor(k/3600);k=k-(l*3600);j=Math.floor(k/60);k=k-(j*60);if(l<10){m+="0"}m+=l+":";if(j<10){m+="0"}m+=j+":";if(k<10){m+="0"}m+=k;return m};return{init:function(){g=new Date().getTime();pipwerks.SCORM.version="2004";pipwerks.SCORM.handleExitMode=false;return pipwerks.SCORM.init()},getStatus:function(){if(d){return d}else{var j=pipwerks.SCORM.get("cmi.success_status"),k=pipwerks.SCORM.get("cmi.completion_status");d=(j==="unknown")?k:j;return d}},setStatus:function(j){d=j;if(d==="passed"||d==="failed"){pipwerks.SCORM.set("cmi.success_status",d);pipwerks.SCORM.set("cmi.completion_status","completed")}else{pipwerks.SCORM.set("cmi.success_status","unknown");pipwerks.SCORM.set("cmi.completion_status",d)}},getScore:function(){if(c){return c}else{c=pipwerks.SCORM.get("cmi.score.raw");c=$.isNumeric(c)?+c:0;return c}},setScore:function(j){if($.isNumeric(j)){c=parseInt(j,10);pipwerks.SCORM.set("cmi.score.raw",c);pipwerks.SCORM.set("cmi.score.min",0);pipwerks.SCORM.set("cmi.score.max",100);pipwerks.SCORM.set("cmi.score.scaled",c/100);pipwerks.SCORM.save()}},getMasteryScore:function(){if(b){return b}b=pipwerks.SCORM.get("cmi.student_data.mastery_score");if(!$.isNumeric(b)){b=100}return b},setSuspend:function(j){h=j;pipwerks.SCORM.set("cmi.suspend_data",h)},getSuspend:function(){h=h?h:pipwerks.SCORM.get("cmi.suspend_data");return h},setLocation:function(j,k){e=j;pipwerks.SCORM.set("cmi.location",e);pipwerks.SCORM.save()},getLocation:function(){e=e?e:pipwerks.SCORM.get("cmi.location");return e},setInteraction:function(l){var o=l.getIdDetail(),m=l.getTypeActivity(),k=l.getResult(),n=l.getStudentResponse(),j=l.getCorrectResponse();if(k==="wrong"){k="incorrect"}pipwerks.SCORM.set("cmi.interactions."+a+".id",o);pipwerks.SCORM.set("cmi.interactions."+a+".type",m);pipwerks.SCORM.set("cmi.interactions."+a+".result",k);pipwerks.SCORM.set("cmi.interactions."+a+".learner_response",n);if(j!==null){pipwerks.SCORM.set("cmi.interactions."+a+".correct_responses.0.pattern",j)}a++},getLearnerResponse:function(l){var j,k=a-1,m;for(k;k>=0;k--){m=pipwerks.SCORM.get("cmi.interactions."+k+".id");if(m===l){return pipwerks.SCORM.get("cmi.interactions."+k+".learner_response")}}return null},getNumberInteractions:function(){a=pipwerks.SCORM.get("cmi.interactions._count");a=$.isNumeric(a)?+a:0;return a},exit:function(){if(!f){pipwerks.SCORM.set("cmi.session_time",i());pipwerks.SCORM.set("cmi.exit","suspend");pipwerks.SCORM.connection.terminate();f=true}}}});var ApiNone=(function(){var f="not attempted",a=0,e="",d="",c=0,b=[];return{init:function(){$(window).trigger({type:"dataTrackingReady"});return true},getStatus:function(){return f},setStatus:function(g){f=g},getScore:function(){return a},setScore:function(g){a=parseInt(g,10)},getMasteryScore:function(){return 100},setSuspend:function(g){e=g},getSuspend:function(){return e},setLocation:function(g,h){d=g},getLocation:function(){return d},setInteraction:function(g){b.push({id:g.getIdDetail(),learner_response:g.getStudentResponse()})},getLearnerResponse:function(j){var g,h=b.length-1,k;for(h;h>=0;h--){k=b[h].id;if(k===j){return b[h].learner_response}}return null},getNumberInteractions:function(){return 0},exit:function(){}}});var TrackingWrapper=(function(){var b=false,i,k,f=0,d="not attempted";var a=function(n){if(b===true&&window.console&&window.console.log){console.log(n)}};var c=function(){if(typeof TrackingConfig=="undefined"){TrackingConfig=TrackingConfigDefault}if((typeof TrackingConfig.success_status=="undefined")){TrackingConfig.success_status=TrackingConfigDefault.success_status}else{if((TrackingConfig.success_status!=="passed")&&(TrackingConfig.success_status!=="completed")){TrackingConfig.success_status=TrackingConfigDefault.success_status}}if(typeof TrackingConfig.unsuccess_status=="undefined"){TrackingConfig.unsuccess_status=TrackingConfigDefault.unsuccess_status}else{if((TrackingConfig.unsuccess_status!=="failed")&&(TrackingConfig.unsuccess_status!=="incomplete")){TrackingConfig.unsuccess_status=TrackingConfigDefault.unsuccess_status}}if(typeof TrackingConfig.send_score=="undefined"){TrackingConfig.send_score=TrackingConfigDefault.send_score}if(typeof TrackingConfig.send_status=="undefined"){TrackingConfig.send_status=TrackingConfigDefault.send_status}if(typeof TrackingConfig.send_interactions=="undefined"){TrackingConfig.send_interactions=TrackingConfigDefault.send_interactions}if(typeof TrackingConfig.home_page=="undefined"){TrackingConfig.home_page=TrackingConfigDefault.home_page}if(typeof TrackingConfig.name=="undefined"){TrackingConfig.name=TrackingConfigDefault.name}};var m=function(n){n.getId=function(){var o="",p=0;while(p<6){o+=j();p++}return(o)};n.getTypeActivity=function(){return n.type};n.getResult=function(){return n.result};n.getStudentResponse=function(){return n.learner_response};n.getCorrectResponse=function(){return n.correct_responses};n.getIdDetail=function(){return n.id};n.getDescription=function(){return n.description};n.choices=_.map(n.choices,function(p,o){return{id:p.id,description:{und:p.description}}});return n};var l=function(n){n.choices=[];return n};var g=function(n){n.getId=function(){var o="",p=0;while(p<6){o+=j();p++}return(o)};n.getTypeActivity=function(){return n.interactionType};n.getResult=function(){return n.success===true?"correct":"wrong"};n.getStudentResponse=function(){return n.response};n.getCorrectResponse=function(){return n.correctResponsesPattern.toString()};n.getIdDetail=function(){return n.id};n.getDescription=function(){return n.description};return n};var h=function(n){if(n.format){if(n.format==="NetexActivityAPI"){return m(n)}}if(typeof n.getId=="undefined"){return g(n)}else{return l(n)}};var j=function(){return(String.fromCharCode(e()))};var e=function(){var n=Math.floor((Math.random()*122)+1)+48;if((n>48&&n<57)||(n>65&&n<90)||(n>97&&n<122)){return n}else{return(e())}};return{init:function(){c();k=TrackingConfig.type;switch(k){case"tincan":i=new ApiTinCan();break;case"scorm_1_2":i=new ApiScorm_1_2();break;case"scorm_2004":i=new ApiScorm_2004();break;default:k="none";i=new ApiNone()}if(!i.init()){k="none";i=new ApiNone()}if(k!=="tincan"){$(window).trigger({type:"dataTrackingReady"})}a("init:"+k)},getStatus:function(){var n=TrackingConfig.send_status==="true"?i.getStatus():d;a("getStatus:"+n);return n},setStatus:function(o){var q=["not attempted","incomplete","completed","passed","failed"],p=["N","I","C","P","F"],n=o.length===1?$.inArray(o.toUpperCase(),p):$.inArray(o.toLowerCase(),q);if(n!==-1){o=q[n];if(o==="completed"||o==="passed"){o=TrackingConfig.success_status}if(o==="failed"){o=TrackingConfig.unsuccess_status}if(TrackingConfig.send_status==="true"){a("setStatus:"+o);i.setStatus(o)}else{if(o==="incomplete"&&d==="not attempted"){a("setStatus:"+o);i.setStatus(o)}d=o}}},getScore:function(){var n=(TrackingConfig.send_score==="true")?i.getScore():f;if(!$.isNumeric(n)){g_sScore=0}a("getScore:"+n);return n},setScore:function(n){if($.isNumeric(n)){n=parseInt(n,10);if(TrackingConfig.send_score==="true"){if(TrackingConfig.send_status==="false"){if(n>=i.getMasteryScore()&&i.getScore()===0){a("setScore:"+n);i.setScore(n)}else{f=n}}else{a("setScore:"+n);i.setScore(n)}}else{f=n}}},getMasteryScore:function(){var n=i.getMasteryScore();a("getMasteryScore:"+n);return n},setSuspend:function(n){a("setSuspend:"+n);i.setSuspend(n)},getSuspend:function(){var n=i.getSuspend();a("getSuspend:"+n);return n},setLocation:function(n,o){a("setLocation:"+n+","+o);i.setLocation(n,o)},getLocation:function(){var n=i.getLocation();a("getLocation:"+n);return n},setInteraction:function(n){if(TrackingConfig.send_interactions==="true"){n=h(n);a("setInteraction:");i.getNumberInteractions();i.setInteraction(n)}},getLearnerResponse:function(o){var n=i.getLearnerResponse(o);a("getLearnerResponse: "+n);return n},getNumberInteractions:function(){var n=i.getNumberInteractions();a("getNumberInteractions:"+n);return n},getType:function(){a("getType:"+k);return k},exit:function(){i.exit()}}});var TrackingConfigDefault={type:"none",success_status:"passed",unsuccess_status:"failed",send_score:"true",send_status:"true",send_interactions:"true",home_page:"http://netexlearning.com/",name:"anonimous"};
var NetexActivityAPI={currentModel:null,activities:new Array(),score:0,model:Backbone.Model.extend({defaults:{},validate:function(a,b){if(!a.id){return"no hay id"}if(!a.type){return"no hay type"}if(!a.result){return"no hay result"}if(_.indexOf(["true-false","choice","fill-in","long-fill-in","likert","matching","performance","sequencing","numeric","other"],a.type)===-1){return"type no valido"}if(_.indexOf(["correct","incorrect","neutral"],a.result)===-1){return"result no valido"}}}),lms:null,init:function(d){try{var b;var a=this;if(_.isNull(this.currentModel)){this.currentModel=new this.model()}if(d.length<=0){this.lms.setStatus("completed");b=200}else{_.each(d,function(f,e,g){a.activities.push({id:f,score:0,done:false})});this.lms.setStatus("incomplete");b=200}return b}catch(c){return 500}},set:function(g){try{var c;if(_.isNull(this.currentModel)){this.currentModel=new this.model()}this.currentModel.set(g);if(!this.currentModel.isValid()){this.debug(this.currentModel.validationError);c=400}else{this.currentModel.set("format","NetexActivityAPI");this.lms.setInteraction(this.currentModel.toJSON());if(this.activities.length>0){for(var d in this.activities){if(this.activities[d].id===g.id){this.activities[d].done=true;this.activities[d].score=g.score}}}if(this.activities.length>0){var a=0;a=_.reduce(this.activities,function(e,h){return e+h.score},0);this.score=(a===0?0:a/this.activities.length)}this.lms.setScore(this.score);var b=true;if(this.activities.length===0){b=false}else{for(var d in this.activities){if(this.activities[d].done!==true){b=false}}if(!_.every(this.activities,function(h){return(h.done===true)})){b=false}}if(b===true){this.lms.setStatus("completed")}c=200}return c}catch(f){return 500}},get:function(a){if(this.lms&&typeof this.lms.getInteraction!="undefined"){return this.lms.getInteraction(a)}return null},debug:function(a){if(document.location.hostname==="localhost"){if(window.console&&window.console.log){console.log(a)}}},error:function(){}};
var Simon={Model:{},Collection:{},View:{},Singleton:{},oApiTracking:null,Main:(function(){var c=function(){Simon.Singleton.ActivityModel=new Simon.Model.ActivityModel({allowRepeatedItems:($("#simon").data("allow-repeated-items")==="yes"?true:false),secuenceSize:$("#simon").data("secuence-size"),okSecuenceSound:$("#simon").data("ok-secuence-sound-src"),koSecuenceSound:$("#simon").data("ko-secuence-sound-src"),okClickSound:$("#simon").data("ok-click-sound-src"),koClickSound:$("#simon").data("ko-click-sound-src"),okEndSound:$("#simon").data("ok-end-sound-src"),koEndSound:$("#simon").data("ko-end-sound-src"),maxLifes:$("#simon").data("max-lifes")});Simon.Singleton.AudioPlayerModel=new Simon.Model.AudioPlayerModel()};var b=function(){Simon.Singleton.CardCollection=new Simon.Collection.CardCollection()};var a=function(){Simon.Singleton.ActivityView=new Simon.View.ActivityView({model:Simon.Singleton.ActivityModel,el:$("#simon")});Simon.Singleton.CardView=new Simon.View.CardView({model:Simon.Singleton.CardCollection,el:$(".card")});Simon.Singleton.AudioPlayerView=new Simon.View.AudioPlayerView({model:Simon.Singleton.AudioPlayerModel,el:$("#audio-player")})};var d=function(){$(".card").each(function(){Simon.Singleton.CardCollection.add({id:$(this).attr("id"),audioSrc:$(this).data("audio-src"),state:"down"})})};createAndInitializeTracking=function(){Simon.oApiTracking=new TrackingWrapper();NetexActivityAPI.lms=Simon.oApiTracking;Simon.oApiTracking.init()},trackinginitialized=function(){Simon.oApiTracking.setStatus("C");Simon.oApiTracking.setScore(100)};return{init:function(){$(window).on("dataTrackingReady",trackinginitialized);c();b();d();a();createAndInitializeTracking()}}})()};$(function(){Simon.Main.init();Simon.Singleton.ActivityModel.set("state","INIT")});
Simon.Model.ActivityModel=Backbone.Model.extend({defaults:{state:null,secuence:[],allowRepeatedItems:false,currentSecuenceItem:null,secuenceSize:null,playerSecuence:[],currentLevel:null,currentState:null,maxLifes:null,lostLifes:0,isLocked:true,isAudioPlaying:false,okSecuenceSound:null,koSecuenceSound:null,okClickSound:null,koClickSound:null,okEndSound:null,koEndkSound:null},lock:function(){return this.set("isLocked",true)},unlock:function(){return this.set("isLocked",false)},isLocked:function(){return this.get("isLocked")},nextState:function(){switch(this.get("state")){case"INIT":this.set("state","PLAY_SECUENCE");break;case"PLAY_SECUENCE":this.set("state","PLAYER_TURN");break;case"PLAYER_TURN":this.set("state","FEEDBACK");break;default:this.set("state","INIT")}},nextSecuenceItem:function(){var a=parseInt(this.get("currentSecuenceItem")+1);this.set("currentSecuenceItem",a<this.get("currentLevel")?a:null)},check:function(){var a=true;var b=this;_.each(this.get("playerSecuence"),function(d,c){if(b.get("playerSecuence")[c]!==b.get("secuence")[c]){a=false;b.set("lostLifes",b.get("lostLifes")+1);return false}});this.set("currentState",a?"success":"fail");return a},generateRandomSecuence:function(){var b=[];var c=Simon.Singleton.CardCollection.pluck("id");if(this.get("allowRepeatedItems")===true){while(b.length<parseInt(this.get("secuenceSize"))){var a=Math.floor(Math.random()*c.length);var d=c[a];b.push(d)}}else{while(c.length>0){var a=Math.floor(Math.random()*c.length);var d=c[a];b.push(d);c.splice(a,1)}}return b},isFinished:function(){return this.get("state")==="FINISHED"}});
Simon.Model.CardModel=Backbone.Model.extend({defaults:{audioSrc:null}});
Simon.Model.AudioPlayerModel=Backbone.Model.extend({defaults:{source:null}});
Simon.Collection.CardCollection=Backbone.Collection.extend({model:Simon.Model.CardModel,getById:function(b){var a=this.where({id:b});return a.length===1?a[0]:null}});
Simon.View.ActivityView=Backbone.View.extend({events:{"click #play-btn":"clickPlayButton","click #restart-btn":"clickRestartButton","click #feedback-ok":"clickContinueButton","click #feedback-ko":"clickRetryButton","click #feedback-done":"clickRestartButton","click #feedback-game-over":"clickRestartButton"},initialize:function(){this.listenTo(this.model,"change:state",this.changeState);this.listenTo(this.model,"change:lostLifes",this.changeLostLifes);this.listenTo(this.model,"change:currentLevel",this.changeCurrentLevel);this.listenTo(this.model,"change:currentSecuenceItem",this.changeCurrentSecuenceItem)},render:function(){return this},clickPlayButton:function(){if(this.model.get("state")==="INIT"){this.model.nextState()}},clickRestartButton:function(){if(this.model.get("state")!=="INIT"){this.model.set("state","INIT")}},clickContinueButton:function(){this.prepareLevel();this.model.set("state","PLAY_SECUENCE")},clickRetryButton:function(){this.prepareLevel();this.model.set("state","PLAY_SECUENCE")},changeState:function(){if(this.model.get("state")==="INIT"){$("#play-btn").addClass("active")}else{$("#play-btn").removeClass("active")}if(this.model.get("state")!=="INIT"){$("#restart-btn").addClass("active")}else{$("#restart-btn").removeClass("active")}if(this.model.get("state")==="PLAYER_TURN"){$("#simon-content").addClass("active")}else{$("#simon-content").removeClass("active")}switch(this.model.get("state")){case"INIT":this.initActivity();break;case"PLAY_SECUENCE":var a=this;setTimeout(function(){a.playSecuence()},500);break;case"PLAYER_TURN":this.playerTurn();break;case"FEEDBACK":if(this.model.get("lostLifes")===this.model.get("maxLifes")||((this.model.get("playerSecuence").length===this.model.get("secuenceSize")&&this.model.get("currentState")==="success"))){this.model.set("state","FINISHED")}else{var a=this;setTimeout(function(){a.showFeedback()},1000)}break;case"FINISHED":var a=this;setTimeout(function(){a.showFeedbackEnded()},1000);break}},initActivity:function(){var a=this.model.generateRandomSecuence();this.prepareLevel();this.model.set("currentLevel",1);this.model.set("lostLifes",0);this.model.set("secuence",a)},playSecuence:function(){this.model.set("currentSecuenceItem",0);Simon.Singleton.AudioPlayerView.$el.on("ended",function(){Simon.Singleton.ActivityModel.nextSecuenceItem()})},playerTurn:function(){Simon.Singleton.ActivityModel.unlock();Simon.Singleton.AudioPlayerView.$el.off("ended")},showFeedback:function(){if(this.model.get("currentState")==="fail"){Simon.Singleton.AudioPlayerView.play(Simon.Singleton.ActivityModel.get("koSecuenceSound"));this.$("#feedback-ko").fadeIn()}else{Simon.Singleton.AudioPlayerView.play(Simon.Singleton.ActivityModel.get("okSecuenceSound"));this.model.set("currentLevel",this.model.get("currentLevel")+1);this.$("#feedback-ok").fadeIn()}},showFeedbackEnded:function(){if(this.model.get("lostLifes")===this.model.get("maxLifes")){Simon.Singleton.AudioPlayerView.play(Simon.Singleton.ActivityModel.get("koEndSound"));$("#feedback-game-over").fadeIn()}else{Simon.Singleton.AudioPlayerView.play(Simon.Singleton.ActivityModel.get("okEndSound"));this.model.set("currentLevel",this.model.get("currentLevel")+1);$("#feedback-done").fadeIn()}},changeCurrentLevel:function(){this.$("#score-number").html(this.model.get("currentLevel")-1)},changeLostLifes:function(){if(Simon.Singleton.ActivityModel.get("state")!=="FINISHED"){var a=this;setTimeout(function(){var b=parseInt(a.model.get("lostLifes"));a.$($(".life-icon").get().reverse()).each(function(){if(b>0){$(this).addClass("lost")}else{$(this).removeClass("lost")}b--})},500)}},prepareLevel:function(){this.$(".card-overlay").removeClass("success fail flash animated");Simon.Singleton.CardCollection.each(function(a){a.set("state","down")});this.model.set("playerSecuence",[]);this.$(".feedback").hide()},changeCurrentSecuenceItem:function(){var a=this.model.get("currentSecuenceItem");if(a!==null){var b=Simon.Singleton.CardCollection.getById(this.model.get("secuence")[a]);Simon.Singleton.AudioPlayerView.play(b.get("audioSrc"))}else{this.model.nextState()}}});
Simon.View.AudioPlayerView=Backbone.View.extend({events:{},initialize:function(){},render:function(){return this},play:function(a){this.el.src=a;this.el.play()},});
Simon.View.CardView=Backbone.View.extend({events:{click:"clickCard"},initialize:function(){},render:function(){return this},clickCard:function(c){if(Simon.Singleton.ActivityModel.get("state")==="PLAYER_TURN"&&!Simon.Singleton.ActivityModel.isLocked()){Simon.Singleton.ActivityModel.lock();var b=Simon.Singleton.CardCollection.getById($(c.currentTarget).attr("id"));var d=Simon.Singleton.ActivityModel.get("playerSecuence");d.push(b.get("id"));Simon.Singleton.ActivityModel.set("playerSecuence",d);if(!Simon.Singleton.ActivityModel.check()){Simon.Singleton.AudioPlayerView.play(Simon.Singleton.ActivityModel.get("koClickSound"));$("#"+b.get("id")).find(".card-overlay").addClass("fail flash animated");if(!Simon.Singleton.ActivityModel.isFinished()){Simon.Singleton.ActivityModel.nextState()}}else{Simon.Singleton.AudioPlayerView.play(Simon.Singleton.ActivityModel.get("okClickSound"));$("#"+b.get("id")).find(".card-overlay").addClass("success flash animated");if(Simon.Singleton.ActivityModel.get("playerSecuence").length===Simon.Singleton.ActivityModel.get("currentLevel")){Simon.Singleton.ActivityModel.nextState()}}var a=this;setTimeout(function(){Simon.Singleton.ActivityModel.unlock();a.$el.find(".card-overlay").removeClass("flash , animated , success , fail")},800)}}});
